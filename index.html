<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EBFL GM Spin</title>
    <style>
        body { font-family: sans-serif; background: #0d0d0d; color: #fff; text-align: center; }
        button { padding: 12px 20px; font-size: 18px; cursor: pointer; margin: 10px; border-radius: 8px; border: none; }
        #login, #spinButton { background: #e63946; color: #fff; transition: background 0.3s; }
        #login:hover, #spinButton:hover { background: #f77f00; }
        #result { font-size: 20px; margin-top: 20px; }
        #username { margin-top: 10px; font-weight: bold; }
        #cards { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        .card { background: #1a1a1a; padding: 20px; border-radius: 10px; font-size: 18px; width: 120px; transition: transform 0.2s; }
        .card.active { background: #e63946; transform: scale(1.1); }
    </style>
</head>
<body>
    <h1>EBFL GM Spin</h1>
    <div id="username"></div>
    <button id="login">Login with Discord</button>
    <div id="cards"></div>
    <button id="spinButton" style="display:none;">SPIN</button>
    <div id="result"></div>

    <audio id="spinSound" src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3"></audio>

    <script>
        const backendUrl = "https://ebfl-oauth-backend-production.up.railway.app";
        const prizes = [
            'EP', 'EC', 'Discord Coin', 'Badge Card (Bronze)', 'Badge Card (Silver)',
            'Badge Card (Gold)', 'Badge Card (HoF)', 'Upgrade Badge', 'Attributes (Basic)',
            'Attributes (Standard)', 'Attributes (Premium)', 'Increase Attribute Limits',
            'Hotzone (Neutral)', 'Hotzone (Cold)', 'Hotzone (Hot)', 'Cold Zone Removal',
            'Dunk Package', 'Layup Package'
        ];
        const cardsContainer = document.getElementById('cards');
        const spinButton = document.getElementById('spinButton');
        const loginButton = document.getElementById('login');
        const resultDiv = document.getElementById('result');
        const usernameDiv = document.getElementById('username');
        const spinSound = document.getElementById('spinSound');

        prizes.forEach(prize => {
            const div = document.createElement('div');
            div.className = 'card';
            div.textContent = prize;
            cardsContainer.appendChild(div);
        });

        loginButton.addEventListener('click', () => {
            window.location.href = backendUrl + '/auth/discord';
        });

        async function checkAuth() {
            const res = await fetch(backendUrl + '/auth/check', { credentials: 'include' });
            if (res.ok) {
                const data = await res.json();
                usernameDiv.textContent = `Logged in as ${data.username}`;
                loginButton.style.display = 'none';
                spinButton.style.display = 'inline-block';
            }
        }

        spinButton.addEventListener('click', async () => {
            spinButton.disabled = true;
            spinSound.play();
            resultDiv.textContent = '';
            const cards = document.querySelectorAll('.card');
            let activeIndex = 0;
            const interval = setInterval(() => {
                cards.forEach(card => card.classList.remove('active'));
                cards[activeIndex % cards.length].classList.add('active');
                activeIndex++;
            }, 100);

            setTimeout(async () => {
                clearInterval(interval);
                const response = await fetch(backendUrl + '/spin', { credentials: 'include' });
                const data = await response.json();
                resultDiv.textContent = `You won: ${data.prize}`;
                cards.forEach(card => {
                    card.classList.remove('active');
                    if (card.textContent === data.prize) card.classList.add('active');
                });
                spinButton.disabled = false;
            }, 10000);
        });

        checkAuth();
    </script>
</body>
</html>
